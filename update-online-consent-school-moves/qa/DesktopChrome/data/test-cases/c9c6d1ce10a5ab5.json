{"uid":"c9c6d1ce10a5ab5","name":"test_session_activity_notes_order","fullName":"tests.test_sessions#test_session_activity_notes_order","historyId":"4c706d8480911507121aee36cf1cb167","time":{"start":1759335220758,"stop":1759335228091,"duration":7333},"description":"\nTest: Add multiple notes to a session and verify their order in the activity log.\nSteps:\n1. Open a session with a fixed child.\n2. Add two notes in sequence.\n3. Refresh and search for the child in the session.\n4. Verify the most recent note appears first in the list.\nVerification:\n- Notes appear in reverse chronological order in the activity log.\n","descriptionHtml":"<p>Test: Add multiple notes to a session and verify their order in the activity log.<br />\nSteps:</p>\n<ol>\n<li>Open a session with a fixed child.</li>\n<li>Add two notes in sequence.</li>\n<li>Refresh and search for the child in the session.</li>\n<li>Verify the most recent note appears first in the list.<br />\nVerification:</li>\n</ol>\n<ul>\n<li>Notes appear in reverse chronological order in the activity log.</li>\n</ul>\n","status":"failed","statusMessage":"AssertionError: Locator expected to have text 'Note 2'\nActual value: \n        Note 1\n       \nCall log:\n  - Expect \"to_have_text\" with timeout 5000ms\n  - waiting for get_by_role(\"blockquote\").first\n    9 × locator resolved to <blockquote>…</blockquote>\n      - unexpected value \"\n        Note 1\n      \"","statusTrace":"setup_fixed_child = None\ndashboard_page = <mavis.test.pages.dashboard.DashboardPage object at 0x7f9a0a9cee60>\nsessions_page = <mavis.test.pages.sessions.SessionsPage object at 0x7f9a0b16f4d0>\nschools = {'HPV': [School(name='Sackville School', urn='119007', site=None), School(name='Oliver House School', urn='131575', si...School', urn='136754', site=None), School(name=\"St Mary's Church of England Primary School\", urn='106106', site=None)]}\nchildren = {'HPV': [Child(first_name='Graeme', last_name='RILEY', nhs_number='9334522100', address=('Flat 32D', 'Ellie lodge', 'W...mmond@example.net'), Parent(full_name='Lesley Haynes', relationship='Mum', email_address='stewartlowe@example.net')))]}\n\n    @issue(\"MAV-1265\")\n    def test_session_activity_notes_order(\n        setup_fixed_child,\n        dashboard_page,\n        sessions_page,\n        schools,\n        children,\n    ):\n        \"\"\"\n        Test: Add multiple notes to a session and verify their order in the activity log.\n        Steps:\n        1. Open a session with a fixed child.\n        2. Add two notes in sequence.\n        3. Refresh and search for the child in the session.\n        4. Verify the most recent note appears first in the list.\n        Verification:\n        - Notes appear in reverse chronological order in the activity log.\n        \"\"\"\n        child = children[Programme.HPV][0]\n        school = schools[Programme.HPV][0]\n        note_1 = \"Note 1\"\n        note_2 = \"Note 2\"\n    \n        sessions_page.click_consent_tab()\n        sessions_page.search_child(child)\n        sessions_page.click_session_activity_and_notes()\n        sessions_page.add_note(note_1)\n>       sessions_page.add_note(note_2)\n\ntests/test_sessions.py:199: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmavis/test/pages/sessions.py:545: in add_note\n    self.check_notes_appear_in_order([note])\nmavis/test/annotations.py:35: in wrapper\n    return_value = func(self, *args, **kwargs)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mavis.test.pages.sessions.SessionsPage object at 0x7f9a0b16f4d0>\nnotes = ['Note 2']\n\n    @step(\"Check that notes appear in order\")\n    def check_notes_appear_in_order(self, notes: list[str]) -> None:\n        for i, note in enumerate(notes):\n>           expect(self.page.get_by_role(\"blockquote\").nth(i)).to_have_text(note)\nE           AssertionError: Locator expected to have text 'Note 2'\nE           Actual value: \nE                   Note 1\nE                  \nE           Call log:\nE             - Expect \"to_have_text\" with timeout 5000ms\nE             - waiting for get_by_role(\"blockquote\").first\nE               9 × locator resolved to <blockquote>…</blockquote>\nE                 - unexpected value \"\nE                   Note 1\nE                 \"\n\nmavis/test/pages/sessions.py:528: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":2,"retriesStatusChange":false,"beforeStages":[{"name":"base_url","time":{"start":1759335011198,"stop":1759335011198,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_session_faker","time":{"start":1759335011199,"stop":1759335011200,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1759335011199,"stop":1759335011199,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1759335011200,"stop":1759335011200,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1759335011200,"stop":1759335011200,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"year_groups","time":{"start":1759335011201,"stop":1759335011201,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"programmes_enabled","time":{"start":1759335011201,"stop":1759335011201,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"onboarding","time":{"start":1759335011201,"stop":1759335022720,"duration":11519},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"nurse","time":{"start":1759335022721,"stop":1759335022721,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type_launch_args","time":{"start":1759335022721,"stop":1759335022721,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"team","time":{"start":1759335022721,"stop":1759335022721,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_team_after_tests","time":{"start":1759335022721,"stop":1759335022721,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright","time":{"start":1759335022721,"stop":1759335023024,"duration":303},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type","time":{"start":1759335023024,"stop":1759335023025,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device","time":{"start":1759335023024,"stop":1759335023024,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"launch_browser","time":{"start":1759335023025,"stop":1759335023025,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connect_options","time":{"start":1759335023025,"stop":1759335023025,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser","time":{"start":1759335023025,"stop":1759335025122,"duration":2097},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1759335025122,"stop":1759335025123,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder","time":{"start":1759335025122,"stop":1759335025122,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1759335025123,"stop":1759335025123,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"basic_auth_credentials","time":{"start":1759335025123,"stop":1759335025123,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"basic_auth_token","time":{"start":1759335025123,"stop":1759335025123,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"schools","time":{"start":1759335130239,"stop":1759335130240,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"organisation","time":{"start":1759335130240,"stop":1759335130240,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"clinics","time":{"start":1759335130240,"stop":1759335130240,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"reset_before_each_module","time":{"start":1759335130240,"stop":1759335131042,"duration":802},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder","time":{"start":1759335212658,"stop":1759335212658,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"output_path","time":{"start":1759335212658,"stop":1759335212658,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context","time":{"start":1759335212658,"stop":1759335212659,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1759335212659,"stop":1759335212664,"duration":5},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"page","time":{"start":1759335212664,"stop":1759335212691,"duration":27},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"set_feature_flags","time":{"start":1759335212691,"stop":1759335212691,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"log_in_page","time":{"start":1759335212691,"stop":1759335212691,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"flipper_page","time":{"start":1759335212691,"stop":1759335212691,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"log_in_as_nurse","time":{"start":1759335212692,"stop":1759335215234,"duration":2542},"status":"passed","steps":[{"name":"Go to log in page","time":{"start":1759335212692,"stop":1759335214526,"duration":1834},"status":"passed","steps":[{"name":"Go to log in page","time":{"start":1759335212692,"stop":1759335214526,"duration":1834},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Log in as User(username='clarkealexander@example.com', password='clarkealexander@example.com', role='nurse') and choose team Team(name='Khan PLC est. 1764', workgroup='A212Q', careplus_venue_code='A212Q', email='rogerslee@example.com', phone='+44(0)7700 900 739')","time":{"start":1759335214526,"stop":1759335215234,"duration":708},"status":"passed","steps":[{"name":"Log in as {1} and choose team {2}","time":{"start":1759335214526,"stop":1759335215233,"duration":707},"status":"passed","steps":[{"name":"Log in as User(username='clarkealexander@example.com', password='clarkealexander@example.com', role='nurse')","time":{"start":1759335214526,"stop":1759335215207,"duration":681},"status":"passed","steps":[{"name":"Log in as {1}","time":{"start":1759335214526,"stop":1759335215207,"duration":681},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(User(username='clarkealexander@example.com', password='clarkealexander@example.com', role='nurse'),)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(User(username='clarkealexander@example.com', password='clarkealexander@example.com', role='nurse'), Team(name='Khan PLC est. 1764', workgroup='A212Q', careplus_venue_code='A212Q', email='rogerslee@example.com', phone='+44(0)7700 900 739'))"}],"shouldDisplayMessage":false,"stepsCount":3,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":6,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"dashboard_page","time":{"start":1759335215234,"stop":1759335215234,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_tests","time":{"start":1759335215234,"stop":1759335215518,"duration":284},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1759335215234,"stop":1759335215518,"duration":284},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1759335215234,"stop":1759335215518,"duration":284},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"children","time":{"start":1759335215518,"stop":1759335215522,"duration":4},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_data","time":{"start":1759335215522,"stop":1759335215523,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"sessions_page","time":{"start":1759335215523,"stop":1759335215523,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"import_records_page","time":{"start":1759335215523,"stop":1759335215524,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_fixed_child","time":{"start":1759335215524,"stop":1759335220758,"duration":5234},"status":"passed","steps":[{"name":"Click on 'HPV' session at School(name='Sackville School', urn='119007', site=None)","time":{"start":1759335215524,"stop":1759335216081,"duration":557},"status":"passed","steps":[{"name":"Click on {2} session at {1}","time":{"start":1759335215524,"stop":1759335216081,"duration":557},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(School(name='Sackville School', urn='119007', site=None), <Programme.HPV: 'HPV'>)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Import class lists","time":{"start":1759335216086,"stop":1759335216390,"duration":304},"status":"passed","steps":[{"name":"Click on Import class lists","time":{"start":1759335216086,"stop":1759335216390,"duration":304},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click Continue","time":{"start":1759335216439,"stop":1759335216871,"duration":432},"status":"passed","steps":[{"name":"Click Continue","time":{"start":1759335216439,"stop":1759335216871,"duration":432},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Set input file to PosixPath('working/ClassFileMapping.FIXED_CHILD20251001171336.csv')","time":{"start":1759335216881,"stop":1759335216901,"duration":20},"status":"passed","steps":[{"name":"Set input file to {1}","time":{"start":1759335216881,"stop":1759335216901,"duration":20},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(PosixPath('working/ClassFileMapping.FIXED_CHILD20251001171336.csv'),)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click Continue","time":{"start":1759335216901,"stop":1759335217244,"duration":343},"status":"passed","steps":[{"name":"Click Continue","time":{"start":1759335216901,"stop":1759335217244,"duration":343},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"_coverage","value":"None"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click link with uploaded datetime","time":{"start":1759335217280,"stop":1759335217478,"duration":198},"status":"passed","steps":[{"name":"Click link with uploaded datetime","time":{"start":1759335217281,"stop":1759335217478,"duration":197},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Manage vaccinations in schools","time":{"start":1759335219699,"stop":1759335219886,"duration":187},"status":"passed","steps":[{"name":"Click on Manage vaccinations in schools","time":{"start":1759335219699,"stop":1759335219886,"duration":187},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Sessions","time":{"start":1759335219886,"stop":1759335220185,"duration":299},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1759335219886,"stop":1759335220185,"duration":299},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on 'HPV' session at School(name='Sackville School', urn='119007', site=None)","time":{"start":1759335220186,"stop":1759335220758,"duration":572},"status":"passed","steps":[{"name":"Click on {2} session at {1}","time":{"start":1759335220186,"stop":1759335220758,"duration":572},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(School(name='Sackville School', urn='119007', site=None), <Programme.HPV: 'HPV'>)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":18,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"setup_session_with_file_upload","time":{"start":1759335215524,"stop":1759335215524,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\nTest: Add multiple notes to a session and verify their order in the activity log.\nSteps:\n1. Open a session with a fixed child.\n2. Add two notes in sequence.\n3. Refresh and search for the child in the session.\n4. Verify the most recent note appears first in the list.\nVerification:\n- Notes appear in reverse chronological order in the activity log.\n","status":"failed","statusMessage":"AssertionError: Locator expected to have text 'Note 2'\nActual value: \n        Note 1\n       \nCall log:\n  - Expect \"to_have_text\" with timeout 5000ms\n  - waiting for get_by_role(\"blockquote\").first\n    9 × locator resolved to <blockquote>…</blockquote>\n      - unexpected value \"\n        Note 1\n      \"","statusTrace":"setup_fixed_child = None\ndashboard_page = <mavis.test.pages.dashboard.DashboardPage object at 0x7f9a0a9cee60>\nsessions_page = <mavis.test.pages.sessions.SessionsPage object at 0x7f9a0b16f4d0>\nschools = {'HPV': [School(name='Sackville School', urn='119007', site=None), School(name='Oliver House School', urn='131575', si...School', urn='136754', site=None), School(name=\"St Mary's Church of England Primary School\", urn='106106', site=None)]}\nchildren = {'HPV': [Child(first_name='Graeme', last_name='RILEY', nhs_number='9334522100', address=('Flat 32D', 'Ellie lodge', 'W...mmond@example.net'), Parent(full_name='Lesley Haynes', relationship='Mum', email_address='stewartlowe@example.net')))]}\n\n    @issue(\"MAV-1265\")\n    def test_session_activity_notes_order(\n        setup_fixed_child,\n        dashboard_page,\n        sessions_page,\n        schools,\n        children,\n    ):\n        \"\"\"\n        Test: Add multiple notes to a session and verify their order in the activity log.\n        Steps:\n        1. Open a session with a fixed child.\n        2. Add two notes in sequence.\n        3. Refresh and search for the child in the session.\n        4. Verify the most recent note appears first in the list.\n        Verification:\n        - Notes appear in reverse chronological order in the activity log.\n        \"\"\"\n        child = children[Programme.HPV][0]\n        school = schools[Programme.HPV][0]\n        note_1 = \"Note 1\"\n        note_2 = \"Note 2\"\n    \n        sessions_page.click_consent_tab()\n        sessions_page.search_child(child)\n        sessions_page.click_session_activity_and_notes()\n        sessions_page.add_note(note_1)\n>       sessions_page.add_note(note_2)\n\ntests/test_sessions.py:199: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmavis/test/pages/sessions.py:545: in add_note\n    self.check_notes_appear_in_order([note])\nmavis/test/annotations.py:35: in wrapper\n    return_value = func(self, *args, **kwargs)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <mavis.test.pages.sessions.SessionsPage object at 0x7f9a0b16f4d0>\nnotes = ['Note 2']\n\n    @step(\"Check that notes appear in order\")\n    def check_notes_appear_in_order(self, notes: list[str]) -> None:\n        for i, note in enumerate(notes):\n>           expect(self.page.get_by_role(\"blockquote\").nth(i)).to_have_text(note)\nE           AssertionError: Locator expected to have text 'Note 2'\nE           Actual value: \nE                   Note 1\nE                  \nE           Call log:\nE             - Expect \"to_have_text\" with timeout 5000ms\nE             - waiting for get_by_role(\"blockquote\").first\nE               9 × locator resolved to <blockquote>…</blockquote>\nE                 - unexpected value \"\nE                   Note 1\nE                 \"\n\nmavis/test/pages/sessions.py:528: AssertionError","steps":[{"name":"Click on Consent tab","time":{"start":1759335220758,"stop":1759335221000,"duration":242},"status":"passed","steps":[{"name":"Click on Consent tab","time":{"start":1759335220758,"stop":1759335221000,"duration":242},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Search for 'RILEY, Graeme'","time":{"start":1759335221000,"stop":1759335221263,"duration":263},"status":"passed","steps":[{"name":"Search for {1}","time":{"start":1759335221000,"stop":1759335221263,"duration":263},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"('RILEY, Graeme',)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Session activity and notes tab","time":{"start":1759335221500,"stop":1759335221849,"duration":349},"status":"passed","steps":[{"name":"Click on Session activity and notes tab","time":{"start":1759335221500,"stop":1759335221849,"duration":349},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Add a note","time":{"start":1759335221849,"stop":1759335221889,"duration":40},"status":"passed","steps":[{"name":"Click on Add a note","time":{"start":1759335221849,"stop":1759335221889,"duration":40},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Fill note textbox with 'Note 1'","time":{"start":1759335221889,"stop":1759335221896,"duration":7},"status":"passed","steps":[{"name":"Fill note textbox with {1}","time":{"start":1759335221889,"stop":1759335221896,"duration":7},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"('Note 1',)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Save note","time":{"start":1759335221899,"stop":1759335222293,"duration":394},"status":"passed","steps":[{"name":"Click on Save note","time":{"start":1759335221899,"stop":1759335222293,"duration":394},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Check that notes appear in order","time":{"start":1759335222330,"stop":1759335222333,"duration":3},"status":"passed","steps":[{"name":"Check that notes appear in order","time":{"start":1759335222330,"stop":1759335222333,"duration":3},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(['Note 1'],)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Add a note","time":{"start":1759335222333,"stop":1759335222374,"duration":41},"status":"passed","steps":[{"name":"Click on Add a note","time":{"start":1759335222333,"stop":1759335222374,"duration":41},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Fill note textbox with 'Note 2'","time":{"start":1759335222374,"stop":1759335222381,"duration":7},"status":"passed","steps":[{"name":"Fill note textbox with {1}","time":{"start":1759335222374,"stop":1759335222381,"duration":7},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"('Note 2',)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Save note","time":{"start":1759335222385,"stop":1759335222759,"duration":374},"status":"passed","steps":[{"name":"Click on Save note","time":{"start":1759335222385,"stop":1759335222759,"duration":374},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Check that notes appear in order","time":{"start":1759335222790,"stop":1759335228090,"duration":5300},"status":"failed","statusMessage":"AssertionError: Locator expected to have text 'Note 2'\nActual value: \n        Note 1\n       \nCall log:\n  - Expect \"to_have_text\" with timeout 5000ms\n  - waiting for get_by_role(\"blockquote\").first\n    9 × locator resolved to <blockquote>…</blockquote>\n      - unexpected value \"\n        Note 1\n      \"\n\n","statusTrace":"  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.13/site-packages/allure_commons/_allure.py\", line 202, in impl\n    return func(*a, **kw)\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/mavis/test/annotations.py\", line 35, in wrapper\n    return_value = func(self, *args, **kwargs)\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/mavis/test/pages/sessions.py\", line 528, in check_notes_appear_in_order\n    expect(self.page.get_by_role(\"blockquote\").nth(i)).to_have_text(note)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.13/site-packages/playwright/sync_api/_generated.py\", line 19981, in to_have_text\n    self._sync(\n    ~~~~~~~~~~^\n        self._impl_obj.to_have_text(\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<4 lines>...\n        )\n        ^\n    )\n    ^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.13/site-packages/playwright/_impl/_sync_base.py\", line 115, in _sync\n    return task.result()\n           ~~~~~~~~~~~^^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.13/site-packages/playwright/_impl/_assertions.py\", line 559, in to_have_text\n    await self._expect_impl(\n    ...<9 lines>...\n    )\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.13/site-packages/playwright/_impl/_assertions.py\", line 83, in _expect_impl\n    raise AssertionError(\n        f\"{out_message}\\nActual value: {actual} {format_call_log(result.get('log'))}\"\n    )\n","steps":[{"name":"Check that notes appear in order","time":{"start":1759335222790,"stop":1759335228089,"duration":5299},"status":"failed","statusMessage":"AssertionError: Locator expected to have text 'Note 2'\nActual value: \n        Note 1\n       \nCall log:\n  - Expect \"to_have_text\" with timeout 5000ms\n  - waiting for get_by_role(\"blockquote\").first\n    9 × locator resolved to <blockquote>…</blockquote>\n      - unexpected value \"\n        Note 1\n      \"\n\n","statusTrace":"  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/mavis/test/annotations.py\", line 35, in wrapper\n    return_value = func(self, *args, **kwargs)\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/mavis/test/pages/sessions.py\", line 528, in check_notes_appear_in_order\n    expect(self.page.get_by_role(\"blockquote\").nth(i)).to_have_text(note)\n    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.13/site-packages/playwright/sync_api/_generated.py\", line 19981, in to_have_text\n    self._sync(\n    ~~~~~~~~~~^\n        self._impl_obj.to_have_text(\n        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<4 lines>...\n        )\n        ^\n    )\n    ^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.13/site-packages/playwright/_impl/_sync_base.py\", line 115, in _sync\n    return task.result()\n           ~~~~~~~~~~~^^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.13/site-packages/playwright/_impl/_assertions.py\", line 559, in to_have_text\n    await self._expect_impl(\n    ...<9 lines>...\n    )\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.13/site-packages/playwright/_impl/_assertions.py\", line 83, in _expect_impl\n    raise AssertionError(\n        f\"{out_message}\\nActual value: {actual} {format_call_log(result.get('log'))}\"\n    )\n","steps":[],"attachments":[{"uid":"beab8da3a3d4e927","name":"Screenshot on failure","source":"beab8da3a3d4e927.png","type":"image/png","size":29144}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(['Note 2'],)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":1,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":22,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"setup_fixed_child::0","time":{"start":1759335228109,"stop":1759335229107,"duration":998},"status":"passed","steps":[{"name":"Go to dashboard","time":{"start":1759335228109,"stop":1759335228272,"duration":163},"status":"passed","steps":[{"name":"Go to dashboard","time":{"start":1759335228109,"stop":1759335228272,"duration":163},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Manage vaccinations in schools","time":{"start":1759335228272,"stop":1759335228461,"duration":189},"status":"passed","steps":[{"name":"Click on Manage vaccinations in schools","time":{"start":1759335228272,"stop":1759335228460,"duration":188},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Sessions","time":{"start":1759335228461,"stop":1759335228690,"duration":229},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1759335228461,"stop":1759335228690,"duration":229},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":6,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"log_in_as_nurse::0","time":{"start":1759335229110,"stop":1759335229508,"duration":398},"status":"passed","steps":[{"name":"Log out","time":{"start":1759335229110,"stop":1759335229508,"duration":398},"status":"passed","steps":[{"name":"Log out","time":{"start":1759335229110,"stop":1759335229508,"duration":398},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"set_feature_flags::0","time":{"start":1759335229509,"stop":1759335229509,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context::0","time":{"start":1759335229510,"stop":1759335229518,"duration":8},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder::0","time":{"start":1759335229519,"stop":1759335229519,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder::0","time":{"start":1759335503888,"stop":1759335503888,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser::0","time":{"start":1759335503889,"stop":1759335503913,"duration":24},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright::0","time":{"start":1759335503914,"stop":1759335503924,"duration":10},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_team_after_tests::0","time":{"start":1759335503925,"stop":1759335506838,"duration":2913},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"sessions"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_sessions"},{"name":"host","value":"runnervm3ublj"},{"name":"thread","value":"2186-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_sessions"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[{"name":"MAV-1265","url":"https://nhsd-jira.digital.nhs.uk/browse/MAV-1265","type":"issue"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"b3cbd79ef7cd4dcb","status":"failed","statusDetails":"AssertionError: Locator expected to have text 'Note 2'\nActual value: \n        Note 1\n       \nCall log:\n  - Expect \"to_have_text\" with timeout 5000ms\n  - waiting for get_by_role(\"blockquote\").first\n    9 × locator resolved to <blockquote>…</blockquote>\n      - unexpected value \"\n        Note 1\n      \"","time":{"start":1759335203883,"stop":1759335211212,"duration":7329}},{"uid":"4c99015be2dc6033","status":"failed","statusDetails":"AssertionError: Locator expected to have text 'Note 2'\nActual value: \n        Note 1\n       \nCall log:\n  - Expect \"to_have_text\" with timeout 5000ms\n  - waiting for get_by_role(\"blockquote\").first\n    9 × locator resolved to <blockquote>…</blockquote>\n      - unexpected value \"\n        Note 1\n      \"","time":{"start":1759335189159,"stop":1759335196463,"duration":7304}}],"categories":[{"name":"Product defects","matchedStatuses":[]}],"tags":["sessions"]},"source":"c9c6d1ce10a5ab5.json","parameterValues":[]}