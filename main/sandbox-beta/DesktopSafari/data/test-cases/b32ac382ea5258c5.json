{"uid":"b32ac382ea5258c5","name":"test_tallying","fullName":"tests.test_tallying#test_tallying","historyId":"cd3d7fd82bb2e7d2b5b1db559ac7383c","time":{"start":1761756276353,"stop":1761756306367,"duration":30014},"description":"\nTest: Check the tallying feature counts as expected\nSteps:\n1. Record consent for injection, withdraw it, invalidate it,\n   provide nasal spray consent and vaccinate.\n2. Verify the tally updates correctly after each action.\nVerification:\n- Tally counts match expected values after each step.\n","descriptionHtml":"<p>Test: Check the tallying feature counts as expected<br />\nSteps:</p>\n<ol>\n<li>Record consent for injection, withdraw it, invalidate it,<br />\nprovide nasal spray consent and vaccinate.</li>\n<li>Verify the tally updates correctly after each action.<br />\nVerification:</li>\n</ol>\n<ul>\n<li>Tally counts match expected values after each step.</li>\n</ul>\n","status":"broken","statusMessage":"playwright._impl._errors.TimeoutError: Locator.inner_text: Timeout 30000ms exceeded.\nCall log:\n  - waiting for locator(\".nhsuk-card__heading.nhsuk-heading-xs\").filter(has_text=\"No response\").locator(\"xpath=following-sibling::*[1]\")","statusTrace":"setup_fixed_child = {<Vaccine.SEQUIRUS: 'Cell-based Trivalent Influenza Vaccine Seqirus'>: 'ABC123', <Vaccine.FLUENZ: 'Fluenz'>: 'ABC123'}\nsessions_page = <mavis.test.pages.sessions.SessionsPage object at 0x7f092db0d2b0>\nverbal_consent_page = <mavis.test.pages.verbal_consent.VerbalConsentPage object at 0x7f092c59e570>\nchildren = {'HPV': [Child(first_name='Kim', last_name='HARRIS', nhs_number='9146417303', address=('Flat 7', 'Mohammad forks', 'Ne...nhannah@example.org'), Parent(full_name='Amber Franklin', relationship='Mum', email_address='damien68@example.net')))]}\nschools = {'HPV': [School(name=\"Buckler's Mead School\", urn='148830', site=None), School(name='Runnymede College', urn='151906',...ool(name='Wixams Tree Primary Academy', urn='143926', site=None), School(name='Park School', urn='113939', site=None)]}\n\n    @issue(\"MAV-1669\")\n    @pytest.mark.bug\n    def test_tallying(\n        setup_fixed_child,\n        sessions_page,\n        verbal_consent_page,\n        children,\n        schools,\n    ):\n        \"\"\"\n        Test: Check the tallying feature counts as expected\n        Steps:\n        1. Record consent for injection, withdraw it, invalidate it,\n           provide nasal spray consent and vaccinate.\n        2. Verify the tally updates correctly after each action.\n        Verification:\n        - Tally counts match expected values after each step.\n        \"\"\"\n        child = children[Programme.FLU][0]\n        batch_name = setup_fixed_child[Vaccine.FLUENZ]\n        school = schools[Programme.FLU][0]\n    \n>       sessions_page.check_tally_for_category(Programme.FLU, TallyCategory.NO_RESPONSE)\n\ntests/test_tallying.py:89: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmavis/test/pages/sessions.py:1062: in check_tally_for_category\n    assert self.get_total_for_category(programme_category) == 1\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nmavis/test/pages/sessions.py:1071: in get_total_for_category\n    return int(total_locator.inner_text())\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^\n.venv/lib/python3.14/site-packages/playwright/sync_api/_generated.py:16988: in inner_text\n    self._sync(self._impl_obj.inner_text(timeout=timeout))\n.venv/lib/python3.14/site-packages/playwright/_impl/_locator.py:458: in inner_text\n    return await self._frame.inner_text(\n.venv/lib/python3.14/site-packages/playwright/_impl/_frame.py:695: in inner_text\n    return await self._channel.send(\n.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py:69: in send\n    return await self._connection.wrap_api_call(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._connection.Connection object at 0x7f093f3a9be0>\ncb = <function Channel.send.<locals>.<lambda> at 0x7f092d76ba00>\nis_internal = False, title = None\n\n    async def wrap_api_call(\n        self, cb: Callable[[], Any], is_internal: bool = False, title: str = None\n    ) -> Any:\n        if self._api_zone.get():\n            return await cb()\n        task = asyncio.current_task(self._loop)\n        st: List[inspect.FrameInfo] = getattr(\n            task, \"__pw_stack__\", None\n        ) or inspect.stack(0)\n    \n        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal, title)\n        self._api_zone.set(parsed_st)\n        try:\n            return await cb()\n        except Exception as error:\n>           raise rewrite_error(error, f\"{parsed_st['apiName']}: {error}\") from None\nE           playwright._impl._errors.TimeoutError: Locator.inner_text: Timeout 30000ms exceeded.\nE           Call log:\nE             - waiting for locator(\".nhsuk-card__heading.nhsuk-heading-xs\").filter(has_text=\"No response\").locator(\"xpath=following-sibling::*[1]\")\n\n.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py:558: TimeoutError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":2,"retriesStatusChange":false,"beforeStages":[{"name":"_verify_url","time":{"start":1761755379960,"stop":1761755379960,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1761755379960,"stop":1761755379960,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_session_faker","time":{"start":1761755379961,"stop":1761755379963,"duration":2},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1761755379963,"stop":1761755379963,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"onboarding","time":{"start":1761755379964,"stop":1761755400862,"duration":20898},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"year_groups","time":{"start":1761755379964,"stop":1761755379964,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1761755379964,"stop":1761755379964,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"programmes_enabled","time":{"start":1761755379964,"stop":1761755379964,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"clinics","time":{"start":1761755400862,"stop":1761755400863,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"team","time":{"start":1761755400862,"stop":1761755400862,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"nurse","time":{"start":1761755400862,"stop":1761755400862,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"organisation","time":{"start":1761755400862,"stop":1761755400862,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"schools","time":{"start":1761755400862,"stop":1761755400862,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_team_after_tests","time":{"start":1761755400862,"stop":1761755400862,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type_launch_args","time":{"start":1761755400863,"stop":1761755400863,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright","time":{"start":1761755400863,"stop":1761755401166,"duration":303},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type","time":{"start":1761755401166,"stop":1761755401167,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device","time":{"start":1761755401166,"stop":1761755401166,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser","time":{"start":1761755401167,"stop":1761755401293,"duration":126},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connect_options","time":{"start":1761755401167,"stop":1761755401167,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"launch_browser","time":{"start":1761755401167,"stop":1761755401167,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder","time":{"start":1761755401293,"stop":1761755401293,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1761755401293,"stop":1761755401294,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"basic_auth_token","time":{"start":1761755401294,"stop":1761755401295,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"basic_auth_credentials","time":{"start":1761755401294,"stop":1761755401294,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1761755401295,"stop":1761755401295,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"reset_before_each_module","time":{"start":1761756161728,"stop":1761756163902,"duration":2174},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"output_path","time":{"start":1761756261905,"stop":1761756261905,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context","time":{"start":1761756261905,"stop":1761756261905,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1761756261905,"stop":1761756261911,"duration":6},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder","time":{"start":1761756261905,"stop":1761756261905,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"page","time":{"start":1761756261911,"stop":1761756262117,"duration":206},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"flipper_page","time":{"start":1761756262117,"stop":1761756262117,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"set_feature_flags","time":{"start":1761756262117,"stop":1761756262117,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"log_in_page","time":{"start":1761756262118,"stop":1761756262118,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"log_in_as_nurse","time":{"start":1761756262118,"stop":1761756265025,"duration":2907},"status":"passed","steps":[{"name":"Go to log in page","time":{"start":1761756262118,"stop":1761756263733,"duration":1615},"status":"passed","steps":[{"name":"Go to log in page","time":{"start":1761756262118,"stop":1761756263733,"duration":1615},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Log in as User(username='geraldinemarsh@example.org', password='geraldinemarsh@example.org', role='nurse') and choose team Team(name='Smith PLC est. 1817', workgroup='L066L', careplus_venue_code='L066L', email='ojones@example.net', phone='(07700) 900314')","time":{"start":1761756263733,"stop":1761756265025,"duration":1292},"status":"passed","steps":[{"name":"Log in as {1} and choose team {2}","time":{"start":1761756263733,"stop":1761756265025,"duration":1292},"status":"passed","steps":[{"name":"Log in as User(username='geraldinemarsh@example.org', password='geraldinemarsh@example.org', role='nurse')","time":{"start":1761756263734,"stop":1761756264986,"duration":1252},"status":"passed","steps":[{"name":"Log in as {1}","time":{"start":1761756263734,"stop":1761756264986,"duration":1252},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(User(username='geraldinemarsh@example.org', password='geraldinemarsh@example.org', role='nurse'),)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(User(username='geraldinemarsh@example.org', password='geraldinemarsh@example.org', role='nurse'), Team(name='Smith PLC est. 1817', workgroup='L066L', careplus_venue_code='L066L', email='ojones@example.net', phone='(07700) 900314'))"}],"shouldDisplayMessage":false,"stepsCount":3,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":6,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"setup_tests","time":{"start":1761756265025,"stop":1761756265332,"duration":307},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1761756265025,"stop":1761756265332,"duration":307},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1761756265025,"stop":1761756265332,"duration":307},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"dashboard_page","time":{"start":1761756265025,"stop":1761756265025,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"add_batch_page","time":{"start":1761756265332,"stop":1761756265332,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"vaccines_page","time":{"start":1761756265333,"stop":1761756265333,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"add_vaccine_batch","time":{"start":1761756265333,"stop":1761756265333,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"children","time":{"start":1761756265333,"stop":1761756265340,"duration":7},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_data","time":{"start":1761756265340,"stop":1761756265343,"duration":3},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"sessions_page","time":{"start":1761756265344,"stop":1761756265344,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"import_records_page","time":{"start":1761756265344,"stop":1761756265344,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_session_with_file_upload","time":{"start":1761756265345,"stop":1761756265345,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_fixed_child","time":{"start":1761756265345,"stop":1761756276352,"duration":11007},"status":"passed","steps":[{"name":"Go to vaccines page","time":{"start":1761756265345,"stop":1761756265802,"duration":457},"status":"passed","steps":[{"name":"Go to vaccines page","time":{"start":1761756265345,"stop":1761756265802,"duration":457},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Add batch for 'Cell-based Trivalent Influenza Vaccine Seqirus'","time":{"start":1761756265802,"stop":1761756266091,"duration":289},"status":"passed","steps":[{"name":"Add batch for {1}","time":{"start":1761756265802,"stop":1761756266091,"duration":289},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(<Vaccine.SEQUIRUS: 'Cell-based Trivalent Influenza Vaccine Seqirus'>,)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Fill in name with 'ABC123'","time":{"start":1761756266091,"stop":1761756266164,"duration":73},"status":"passed","steps":[{"name":"Fill in name with {1}","time":{"start":1761756266092,"stop":1761756266164,"duration":72},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"('ABC123',)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Fill in expiry date with datetime.date(2025, 10, 30)","time":{"start":1761756266164,"stop":1761756266232,"duration":68},"status":"passed","steps":[{"name":"Fill in expiry date with {1}","time":{"start":1761756266164,"stop":1761756266232,"duration":68},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(datetime.date(2025, 10, 30),)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Confirm add batch","time":{"start":1761756266233,"stop":1761756266794,"duration":561},"status":"passed","steps":[{"name":"Confirm add batch","time":{"start":1761756266233,"stop":1761756266794,"duration":561},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Go to vaccines page","time":{"start":1761756266794,"stop":1761756267195,"duration":401},"status":"passed","steps":[{"name":"Go to vaccines page","time":{"start":1761756266794,"stop":1761756267195,"duration":401},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Add batch for 'Fluenz'","time":{"start":1761756267196,"stop":1761756267562,"duration":366},"status":"passed","steps":[{"name":"Add batch for {1}","time":{"start":1761756267196,"stop":1761756267562,"duration":366},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(<Vaccine.FLUENZ: 'Fluenz'>,)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Fill in name with 'ABC123'","time":{"start":1761756267562,"stop":1761756267616,"duration":54},"status":"passed","steps":[{"name":"Fill in name with {1}","time":{"start":1761756267562,"stop":1761756267616,"duration":54},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"('ABC123',)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Fill in expiry date with datetime.date(2025, 10, 30)","time":{"start":1761756267617,"stop":1761756267662,"duration":45},"status":"passed","steps":[{"name":"Fill in expiry date with {1}","time":{"start":1761756267617,"stop":1761756267662,"duration":45},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(datetime.date(2025, 10, 30),)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Confirm add batch","time":{"start":1761756267662,"stop":1761756268258,"duration":596},"status":"passed","steps":[{"name":"Confirm add batch","time":{"start":1761756267662,"stop":1761756268258,"duration":596},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Manage vaccinations in schools","time":{"start":1761756268258,"stop":1761756268541,"duration":283},"status":"passed","steps":[{"name":"Click on Manage vaccinations in schools","time":{"start":1761756268258,"stop":1761756268541,"duration":283},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Sessions","time":{"start":1761756268541,"stop":1761756268890,"duration":349},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1761756268541,"stop":1761756268890,"duration":349},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on 'flu' session at School(name='Wixams Tree Primary Academy', urn='143926', site=None)","time":{"start":1761756268890,"stop":1761756269845,"duration":955},"status":"passed","steps":[{"name":"Click on {2} session at {1}","time":{"start":1761756268890,"stop":1761756269845,"duration":955},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(School(name='Wixams Tree Primary Academy', urn='143926', site=None), <Programme.FLU: 'flu'>)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Import class lists","time":{"start":1761756269853,"stop":1761756270303,"duration":450},"status":"passed","steps":[{"name":"Click on Import class lists","time":{"start":1761756269853,"stop":1761756270303,"duration":450},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click Continue","time":{"start":1761756270470,"stop":1761756271341,"duration":871},"status":"passed","steps":[{"name":"Click Continue","time":{"start":1761756270471,"stop":1761756271341,"duration":870},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Set input file to PosixPath('working/ClassFileMapping.FIXED_CHILD20251029164431.csv')","time":{"start":1761756271353,"stop":1761756271392,"duration":39},"status":"passed","steps":[{"name":"Set input file to {1}","time":{"start":1761756271353,"stop":1761756271392,"duration":39},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(PosixPath('working/ClassFileMapping.FIXED_CHILD20251029164431.csv'),)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click Continue","time":{"start":1761756272392,"stop":1761756273157,"duration":765},"status":"passed","steps":[{"name":"Click Continue","time":{"start":1761756272392,"stop":1761756273157,"duration":765},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"_coverage","value":"None"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click link with uploaded datetime","time":{"start":1761756273337,"stop":1761756273580,"duration":243},"status":"passed","steps":[{"name":"Click link with uploaded datetime","time":{"start":1761756273337,"stop":1761756273580,"duration":243},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Manage vaccinations in schools","time":{"start":1761756274709,"stop":1761756274968,"duration":259},"status":"passed","steps":[{"name":"Click on Manage vaccinations in schools","time":{"start":1761756274709,"stop":1761756274967,"duration":258},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Sessions","time":{"start":1761756274968,"stop":1761756275419,"duration":451},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1761756274968,"stop":1761756275419,"duration":451},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on 'flu' session at School(name='Wixams Tree Primary Academy', urn='143926', site=None)","time":{"start":1761756275420,"stop":1761756276351,"duration":931},"status":"passed","steps":[{"name":"Click on {2} session at {1}","time":{"start":1761756275420,"stop":1761756276351,"duration":931},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(School(name='Wixams Tree Primary Academy', urn='143926', site=None), <Programme.FLU: 'flu'>)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":42,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"verbal_consent_page","time":{"start":1761756276352,"stop":1761756276352,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\nTest: Check the tallying feature counts as expected\nSteps:\n1. Record consent for injection, withdraw it, invalidate it,\n   provide nasal spray consent and vaccinate.\n2. Verify the tally updates correctly after each action.\nVerification:\n- Tally counts match expected values after each step.\n","status":"broken","statusMessage":"playwright._impl._errors.TimeoutError: Locator.inner_text: Timeout 30000ms exceeded.\nCall log:\n  - waiting for locator(\".nhsuk-card__heading.nhsuk-heading-xs\").filter(has_text=\"No response\").locator(\"xpath=following-sibling::*[1]\")","statusTrace":"setup_fixed_child = {<Vaccine.SEQUIRUS: 'Cell-based Trivalent Influenza Vaccine Seqirus'>: 'ABC123', <Vaccine.FLUENZ: 'Fluenz'>: 'ABC123'}\nsessions_page = <mavis.test.pages.sessions.SessionsPage object at 0x7f092db0d2b0>\nverbal_consent_page = <mavis.test.pages.verbal_consent.VerbalConsentPage object at 0x7f092c59e570>\nchildren = {'HPV': [Child(first_name='Kim', last_name='HARRIS', nhs_number='9146417303', address=('Flat 7', 'Mohammad forks', 'Ne...nhannah@example.org'), Parent(full_name='Amber Franklin', relationship='Mum', email_address='damien68@example.net')))]}\nschools = {'HPV': [School(name=\"Buckler's Mead School\", urn='148830', site=None), School(name='Runnymede College', urn='151906',...ool(name='Wixams Tree Primary Academy', urn='143926', site=None), School(name='Park School', urn='113939', site=None)]}\n\n    @issue(\"MAV-1669\")\n    @pytest.mark.bug\n    def test_tallying(\n        setup_fixed_child,\n        sessions_page,\n        verbal_consent_page,\n        children,\n        schools,\n    ):\n        \"\"\"\n        Test: Check the tallying feature counts as expected\n        Steps:\n        1. Record consent for injection, withdraw it, invalidate it,\n           provide nasal spray consent and vaccinate.\n        2. Verify the tally updates correctly after each action.\n        Verification:\n        - Tally counts match expected values after each step.\n        \"\"\"\n        child = children[Programme.FLU][0]\n        batch_name = setup_fixed_child[Vaccine.FLUENZ]\n        school = schools[Programme.FLU][0]\n    \n>       sessions_page.check_tally_for_category(Programme.FLU, TallyCategory.NO_RESPONSE)\n\ntests/test_tallying.py:89: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmavis/test/pages/sessions.py:1062: in check_tally_for_category\n    assert self.get_total_for_category(programme_category) == 1\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\nmavis/test/pages/sessions.py:1071: in get_total_for_category\n    return int(total_locator.inner_text())\n               ^^^^^^^^^^^^^^^^^^^^^^^^^^\n.venv/lib/python3.14/site-packages/playwright/sync_api/_generated.py:16988: in inner_text\n    self._sync(self._impl_obj.inner_text(timeout=timeout))\n.venv/lib/python3.14/site-packages/playwright/_impl/_locator.py:458: in inner_text\n    return await self._frame.inner_text(\n.venv/lib/python3.14/site-packages/playwright/_impl/_frame.py:695: in inner_text\n    return await self._channel.send(\n.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py:69: in send\n    return await self._connection.wrap_api_call(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._connection.Connection object at 0x7f093f3a9be0>\ncb = <function Channel.send.<locals>.<lambda> at 0x7f092d76ba00>\nis_internal = False, title = None\n\n    async def wrap_api_call(\n        self, cb: Callable[[], Any], is_internal: bool = False, title: str = None\n    ) -> Any:\n        if self._api_zone.get():\n            return await cb()\n        task = asyncio.current_task(self._loop)\n        st: List[inspect.FrameInfo] = getattr(\n            task, \"__pw_stack__\", None\n        ) or inspect.stack(0)\n    \n        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal, title)\n        self._api_zone.set(parsed_st)\n        try:\n            return await cb()\n        except Exception as error:\n>           raise rewrite_error(error, f\"{parsed_st['apiName']}: {error}\") from None\nE           playwright._impl._errors.TimeoutError: Locator.inner_text: Timeout 30000ms exceeded.\nE           Call log:\nE             - waiting for locator(\".nhsuk-card__heading.nhsuk-heading-xs\").filter(has_text=\"No response\").locator(\"xpath=following-sibling::*[1]\")\n\n.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py:558: TimeoutError","steps":[{"name":"Click on Overview tab","time":{"start":1761756276353,"stop":1761756276363,"duration":10},"status":"passed","steps":[{"name":"Click on Overview tab","time":{"start":1761756276353,"stop":1761756276363,"duration":10},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"setup_fixed_child::0","time":{"start":1761756306474,"stop":1761756307870,"duration":1396},"status":"passed","steps":[{"name":"Go to dashboard","time":{"start":1761756306474,"stop":1761756306825,"duration":351},"status":"passed","steps":[{"name":"Go to dashboard","time":{"start":1761756306474,"stop":1761756306825,"duration":351},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Manage vaccinations in schools","time":{"start":1761756306825,"stop":1761756307066,"duration":241},"status":"passed","steps":[{"name":"Click on Manage vaccinations in schools","time":{"start":1761756306825,"stop":1761756307066,"duration":241},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Sessions","time":{"start":1761756307066,"stop":1761756307372,"duration":306},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1761756307067,"stop":1761756307371,"duration":304},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":6,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"log_in_as_nurse::0","time":{"start":1761756307873,"stop":1761756308775,"duration":902},"status":"passed","steps":[{"name":"Log out","time":{"start":1761756307873,"stop":1761756308775,"duration":902},"status":"passed","steps":[{"name":"Log out","time":{"start":1761756307873,"stop":1761756308775,"duration":902},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"set_feature_flags::0","time":{"start":1761756308776,"stop":1761756308776,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context::0","time":{"start":1761756308777,"stop":1761756308791,"duration":14},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder::0","time":{"start":1761756308791,"stop":1761756308791,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder::0","time":{"start":1761756308796,"stop":1761756308796,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser::0","time":{"start":1761756308797,"stop":1761756308886,"duration":89},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright::0","time":{"start":1761756308887,"stop":1761756308897,"duration":10},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_team_after_tests::0","time":{"start":1761756308900,"stop":1761756311047,"duration":2147},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"bug"},{"name":"tag","value":"tallying"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_tallying"},{"name":"host","value":"runnervmwhb2z"},{"name":"thread","value":"5990-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_tallying"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[{"name":"MAV-1669","url":"https://nhsd-jira.digital.nhs.uk/browse/MAV-1669","type":"issue"}],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"c62067b7be3c8fcd","status":"broken","statusDetails":"playwright._impl._errors.TimeoutError: Locator.inner_text: Timeout 30000ms exceeded.\nCall log:\n  - waiting for locator(\".nhsuk-card__heading.nhsuk-heading-xs\").filter(has_text=\"No response\").locator(\"xpath=following-sibling::*[1]\")","time":{"start":1761756229349,"stop":1761756259370,"duration":30021}},{"uid":"4e4a89f76cd51ebd","status":"broken","statusDetails":"playwright._impl._errors.TimeoutError: Locator.inner_text: Timeout 30000ms exceeded.\nCall log:\n  - waiting for locator(\".nhsuk-card__heading.nhsuk-heading-xs\").filter(has_text=\"No response\").locator(\"xpath=following-sibling::*[1]\")","time":{"start":1761756182491,"stop":1761756212503,"duration":30012}}],"categories":[{"name":"Test defects","matchedStatuses":[]}],"tags":["bug","tallying"]},"source":"b32ac382ea5258c5.json","parameterValues":[]}