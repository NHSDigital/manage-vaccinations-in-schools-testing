{"uid":"33774308841268c2","name":"test_invalid_consent","fullName":"tests.test_verbal_consent#test_invalid_consent","historyId":"ba542dc68ed0d25b0c588706a13da109","time":{"start":1761971377274,"stop":1761971409552,"duration":32278},"description":"\nTest: Record invalid and refused consents and verify activity log entries.\nSteps:\n1. Open the session and consent tab for the child.\n2. Record a 'no response' verbal consent for parent 1.\n3. Record a refusal verbal consent for parent 2.\n4. Invalidate the refusal from parent 2.\n5. Check the session activity log for correct entries.\nVerification:\n- Activity log contains entries for invalidated consent, refusal, and no response.\n","descriptionHtml":"<p>Test: Record invalid and refused consents and verify activity log entries.<br />\nSteps:</p>\n<ol>\n<li>Open the session and consent tab for the child.</li>\n<li>Record a 'no response' verbal consent for parent 1.</li>\n<li>Record a refusal verbal consent for parent 2.</li>\n<li>Invalidate the refusal from parent 2.</li>\n<li>Check the session activity log for correct entries.<br />\nVerification:</li>\n</ol>\n<ul>\n<li>Activity log contains entries for invalidated consent, refusal, and no response.</li>\n</ul>\n","status":"broken","statusMessage":"playwright._impl._errors.TimeoutError: Locator.click: Timeout 30000ms exceeded.\nCall log:\n  - waiting for get_by_role(\"heading\", name=\"NICHOLLS, Katherine\").get_by_role(\"link\").first","statusTrace":"setup_fixed_child = None\nsessions_page = <mavis.test.pages.sessions.SessionsPage object at 0x7f6042856ba0>\nschools = {'HPV': [School(name=\"The Queen Elizabeth's High School, Gainsborough\", urn='120655', site=None), School(name=\"Bancrof... Edward's School\", urn='103584', site=None), School(name='The Llewellyn School and Nursery', urn='142859', site=None)]}\nverbal_consent_page = <mavis.test.pages.verbal_consent.VerbalConsentPage object at 0x7f6040fb4950>\nchildren = {'HPV': [Child(first_name='Katherine', last_name='NICHOLLS', nhs_number='9996839966', address=('Studio 5', 'William dr...julian33@example.org'), Parent(full_name='Lynne Parsons', relationship='Mum', email_address='marcbell@example.net')))]}\n\n    @pytest.mark.bug\n    def test_invalid_consent(\n        setup_fixed_child,\n        sessions_page,\n        schools,\n        verbal_consent_page,\n        children,\n    ):\n        \"\"\"\n        Test: Record invalid and refused consents and verify activity log entries.\n        Steps:\n        1. Open the session and consent tab for the child.\n        2. Record a 'no response' verbal consent for parent 1.\n        3. Record a refusal verbal consent for parent 2.\n        4. Invalidate the refusal from parent 2.\n        5. Check the session activity log for correct entries.\n        Verification:\n        - Activity log contains entries for invalidated consent, refusal, and no response.\n        \"\"\"\n        child = children[Programme.HPV][0]\n        school = schools[Programme.HPV][0]\n    \n        sessions_page.click_session_for_programme_group(school, Programme.HPV)\n        sessions_page.click_consent_tab()\n        sessions_page.select_no_response()\n>       sessions_page.navigate_to_consent_response(child, Programme.HPV)\n\ntests/test_verbal_consent.py:140: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmavis/test/pages/sessions.py:489: in navigate_to_consent_response\n    self.click_child(child)\nmavis/test/annotations.py:35: in wrapper\n    return_value = func(self, *args, **kwargs)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^\nmavis/test/pages/sessions.py:361: in click_child\n    ).first.click()\n            ^^^^^^^\n.venv/lib/python3.14/site-packages/playwright/sync_api/_generated.py:15543: in click\n    self._sync(\n.venv/lib/python3.14/site-packages/playwright/_impl/_locator.py:160: in click\n    return await self._frame.click(self._selector, strict=True, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.venv/lib/python3.14/site-packages/playwright/_impl/_frame.py:549: in click\n    await self._channel.send(\"click\", self._timeout, locals_to_params(locals()))\n.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py:69: in send\n    return await self._connection.wrap_api_call(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._connection.Connection object at 0x7f6053dcdbe0>\ncb = <function Channel.send.<locals>.<lambda> at 0x7f60437126c0>\nis_internal = False, title = None\n\n    async def wrap_api_call(\n        self, cb: Callable[[], Any], is_internal: bool = False, title: str = None\n    ) -> Any:\n        if self._api_zone.get():\n            return await cb()\n        task = asyncio.current_task(self._loop)\n        st: List[inspect.FrameInfo] = getattr(\n            task, \"__pw_stack__\", None\n        ) or inspect.stack(0)\n    \n        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal, title)\n        self._api_zone.set(parsed_st)\n        try:\n            return await cb()\n        except Exception as error:\n>           raise rewrite_error(error, f\"{parsed_st['apiName']}: {error}\") from None\nE           playwright._impl._errors.TimeoutError: Locator.click: Timeout 30000ms exceeded.\nE           Call log:\nE             - waiting for get_by_role(\"heading\", name=\"NICHOLLS, Katherine\").get_by_role(\"link\").first\n\n.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py:558: TimeoutError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"base_url","time":{"start":1761970393611,"stop":1761970393611,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1761970393611,"stop":1761970393611,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_session_faker","time":{"start":1761970393612,"stop":1761970393613,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"programmes_enabled","time":{"start":1761970393613,"stop":1761970393613,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1761970393613,"stop":1761970393613,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"year_groups","time":{"start":1761970393613,"stop":1761970393613,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1761970393613,"stop":1761970393613,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"onboarding","time":{"start":1761970393613,"stop":1761970409053,"duration":15440},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"team","time":{"start":1761970409053,"stop":1761970409053,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_team_after_tests","time":{"start":1761970409053,"stop":1761970409053,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type_launch_args","time":{"start":1761970409054,"stop":1761970409054,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"clinics","time":{"start":1761970409054,"stop":1761970409054,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright","time":{"start":1761970409054,"stop":1761970409391,"duration":337},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"schools","time":{"start":1761970409054,"stop":1761970409054,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"nurse","time":{"start":1761970409054,"stop":1761970409054,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"organisation","time":{"start":1761970409054,"stop":1761970409054,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"launch_browser","time":{"start":1761970409392,"stop":1761970409393,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connect_options","time":{"start":1761970409392,"stop":1761970409392,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device","time":{"start":1761970409392,"stop":1761970409392,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type","time":{"start":1761970409392,"stop":1761970409392,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser","time":{"start":1761970409393,"stop":1761970409492,"duration":99},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder","time":{"start":1761970409492,"stop":1761970409492,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1761970409493,"stop":1761970409493,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"basic_auth_credentials","time":{"start":1761970409493,"stop":1761970409493,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"basic_auth_token","time":{"start":1761970409494,"stop":1761970409494,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1761970409494,"stop":1761970409494,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"reset_before_each_module","time":{"start":1761971049343,"stop":1761971051294,"duration":1951},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1761971361627,"stop":1761971361632,"duration":5},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder","time":{"start":1761971361627,"stop":1761971361627,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"output_path","time":{"start":1761971361627,"stop":1761971361627,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context","time":{"start":1761971361627,"stop":1761971361627,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"page","time":{"start":1761971361632,"stop":1761971361656,"duration":24},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"flipper_page","time":{"start":1761971361656,"stop":1761971361656,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"log_in_page","time":{"start":1761971361656,"stop":1761971361656,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"set_feature_flags","time":{"start":1761971361656,"stop":1761971361656,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"log_in_as_nurse","time":{"start":1761971361656,"stop":1761971363886,"duration":2230},"status":"passed","steps":[{"name":"Go to log in page","time":{"start":1761971361656,"stop":1761971362963,"duration":1307},"status":"passed","steps":[{"name":"Go to log in page","time":{"start":1761971361656,"stop":1761971362963,"duration":1307},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Log in as User(username='parryaaron@example.org', password='parryaaron@example.org', role='nurse') and choose team Team(name='Hamilton-Dawson est. 1875', workgroup='K579Y', careplus_venue_code='K579Y', email='patelmaria@example.net', phone='+447700 900709')","time":{"start":1761971362963,"stop":1761971363886,"duration":923},"status":"passed","steps":[{"name":"Log in as {1} and choose team {2}","time":{"start":1761971362963,"stop":1761971363886,"duration":923},"status":"passed","steps":[{"name":"Log in as User(username='parryaaron@example.org', password='parryaaron@example.org', role='nurse')","time":{"start":1761971362963,"stop":1761971363860,"duration":897},"status":"passed","steps":[{"name":"Log in as {1}","time":{"start":1761971362963,"stop":1761971363860,"duration":897},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(User(username='parryaaron@example.org', password='parryaaron@example.org', role='nurse'),)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(User(username='parryaaron@example.org', password='parryaaron@example.org', role='nurse'), Team(name='Hamilton-Dawson est. 1875', workgroup='K579Y', careplus_venue_code='K579Y', email='patelmaria@example.net', phone='+447700 900709'))"}],"shouldDisplayMessage":false,"stepsCount":3,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":6,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"children","time":{"start":1761971363886,"stop":1761971363890,"duration":4},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"dashboard_page","time":{"start":1761971363886,"stop":1761971363886,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"test_data","time":{"start":1761971363890,"stop":1761971363890,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_session_with_file_upload","time":{"start":1761971363891,"stop":1761971363891,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"import_records_page","time":{"start":1761971363891,"stop":1761971363891,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_fixed_child","time":{"start":1761971363891,"stop":1761971377273,"duration":13382},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1761971363891,"stop":1761971364117,"duration":226},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1761971363891,"stop":1761971364117,"duration":226},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on 'HPV' session at School(name=\"The Queen Elizabeth's High School, Gainsborough\", urn='120655', site=None)","time":{"start":1761971364117,"stop":1761971364758,"duration":641},"status":"passed","steps":[{"name":"Click on {2} session at {1}","time":{"start":1761971364117,"stop":1761971364758,"duration":641},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(School(name=\"The Queen Elizabeth's High School, Gainsborough\", urn='120655', site=None), <Programme.HPV: 'HPV'>)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Manage vaccinations in schools","time":{"start":1761971364763,"stop":1761971364962,"duration":199},"status":"passed","steps":[{"name":"Click on Manage vaccinations in schools","time":{"start":1761971364763,"stop":1761971364962,"duration":199},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Sessions","time":{"start":1761971364962,"stop":1761971365205,"duration":243},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1761971364962,"stop":1761971365205,"duration":243},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on 'HPV' session at School(name=\"The Queen Elizabeth's High School, Gainsborough\", urn='120655', site=None)","time":{"start":1761971365205,"stop":1761971365781,"duration":576},"status":"passed","steps":[{"name":"Click on {2} session at {1}","time":{"start":1761971365205,"stop":1761971365781,"duration":576},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(School(name=\"The Queen Elizabeth's High School, Gainsborough\", urn='120655', site=None), <Programme.HPV: 'HPV'>)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Import class lists","time":{"start":1761971365781,"stop":1761971366159,"duration":378},"status":"passed","steps":[{"name":"Click on Import class lists","time":{"start":1761971365781,"stop":1761971366159,"duration":378},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click Continue","time":{"start":1761971366208,"stop":1761971366732,"duration":524},"status":"passed","steps":[{"name":"Click Continue","time":{"start":1761971366208,"stop":1761971366732,"duration":524},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Set input file to PosixPath('working/CohortsFileMapping.FIXED_CHILD20251101042926.csv')","time":{"start":1761971366745,"stop":1761971366765,"duration":20},"status":"passed","steps":[{"name":"Set input file to {1}","time":{"start":1761971366745,"stop":1761971366765,"duration":20},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(PosixPath('working/CohortsFileMapping.FIXED_CHILD20251101042926.csv'),)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click Continue","time":{"start":1761971367766,"stop":1761971368156,"duration":390},"status":"passed","steps":[{"name":"Click Continue","time":{"start":1761971367766,"stop":1761971368156,"duration":390},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"_coverage","value":"None"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click link with uploaded datetime","time":{"start":1761971368185,"stop":1761971368400,"duration":215},"status":"passed","steps":[{"name":"Click link with uploaded datetime","time":{"start":1761971368185,"stop":1761971368400,"duration":215},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Manage vaccinations in schools","time":{"start":1761971376820,"stop":1761971377031,"duration":211},"status":"passed","steps":[{"name":"Click on Manage vaccinations in schools","time":{"start":1761971376820,"stop":1761971377031,"duration":211},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Sessions","time":{"start":1761971377031,"stop":1761971377273,"duration":242},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1761971377031,"stop":1761971377273,"duration":242},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":24,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"sessions_page","time":{"start":1761971363891,"stop":1761971363891,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"verbal_consent_page","time":{"start":1761971377273,"stop":1761971377274,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"\nTest: Record invalid and refused consents and verify activity log entries.\nSteps:\n1. Open the session and consent tab for the child.\n2. Record a 'no response' verbal consent for parent 1.\n3. Record a refusal verbal consent for parent 2.\n4. Invalidate the refusal from parent 2.\n5. Check the session activity log for correct entries.\nVerification:\n- Activity log contains entries for invalidated consent, refusal, and no response.\n","status":"broken","statusMessage":"playwright._impl._errors.TimeoutError: Locator.click: Timeout 30000ms exceeded.\nCall log:\n  - waiting for get_by_role(\"heading\", name=\"NICHOLLS, Katherine\").get_by_role(\"link\").first","statusTrace":"setup_fixed_child = None\nsessions_page = <mavis.test.pages.sessions.SessionsPage object at 0x7f6042856ba0>\nschools = {'HPV': [School(name=\"The Queen Elizabeth's High School, Gainsborough\", urn='120655', site=None), School(name=\"Bancrof... Edward's School\", urn='103584', site=None), School(name='The Llewellyn School and Nursery', urn='142859', site=None)]}\nverbal_consent_page = <mavis.test.pages.verbal_consent.VerbalConsentPage object at 0x7f6040fb4950>\nchildren = {'HPV': [Child(first_name='Katherine', last_name='NICHOLLS', nhs_number='9996839966', address=('Studio 5', 'William dr...julian33@example.org'), Parent(full_name='Lynne Parsons', relationship='Mum', email_address='marcbell@example.net')))]}\n\n    @pytest.mark.bug\n    def test_invalid_consent(\n        setup_fixed_child,\n        sessions_page,\n        schools,\n        verbal_consent_page,\n        children,\n    ):\n        \"\"\"\n        Test: Record invalid and refused consents and verify activity log entries.\n        Steps:\n        1. Open the session and consent tab for the child.\n        2. Record a 'no response' verbal consent for parent 1.\n        3. Record a refusal verbal consent for parent 2.\n        4. Invalidate the refusal from parent 2.\n        5. Check the session activity log for correct entries.\n        Verification:\n        - Activity log contains entries for invalidated consent, refusal, and no response.\n        \"\"\"\n        child = children[Programme.HPV][0]\n        school = schools[Programme.HPV][0]\n    \n        sessions_page.click_session_for_programme_group(school, Programme.HPV)\n        sessions_page.click_consent_tab()\n        sessions_page.select_no_response()\n>       sessions_page.navigate_to_consent_response(child, Programme.HPV)\n\ntests/test_verbal_consent.py:140: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \nmavis/test/pages/sessions.py:489: in navigate_to_consent_response\n    self.click_child(child)\nmavis/test/annotations.py:35: in wrapper\n    return_value = func(self, *args, **kwargs)\n                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^\nmavis/test/pages/sessions.py:361: in click_child\n    ).first.click()\n            ^^^^^^^\n.venv/lib/python3.14/site-packages/playwright/sync_api/_generated.py:15543: in click\n    self._sync(\n.venv/lib/python3.14/site-packages/playwright/_impl/_locator.py:160: in click\n    return await self._frame.click(self._selector, strict=True, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n.venv/lib/python3.14/site-packages/playwright/_impl/_frame.py:549: in click\n    await self._channel.send(\"click\", self._timeout, locals_to_params(locals()))\n.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py:69: in send\n    return await self._connection.wrap_api_call(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._connection.Connection object at 0x7f6053dcdbe0>\ncb = <function Channel.send.<locals>.<lambda> at 0x7f60437126c0>\nis_internal = False, title = None\n\n    async def wrap_api_call(\n        self, cb: Callable[[], Any], is_internal: bool = False, title: str = None\n    ) -> Any:\n        if self._api_zone.get():\n            return await cb()\n        task = asyncio.current_task(self._loop)\n        st: List[inspect.FrameInfo] = getattr(\n            task, \"__pw_stack__\", None\n        ) or inspect.stack(0)\n    \n        parsed_st = _extract_stack_trace_information_from_stack(st, is_internal, title)\n        self._api_zone.set(parsed_st)\n        try:\n            return await cb()\n        except Exception as error:\n>           raise rewrite_error(error, f\"{parsed_st['apiName']}: {error}\") from None\nE           playwright._impl._errors.TimeoutError: Locator.click: Timeout 30000ms exceeded.\nE           Call log:\nE             - waiting for get_by_role(\"heading\", name=\"NICHOLLS, Katherine\").get_by_role(\"link\").first\n\n.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py:558: TimeoutError","steps":[{"name":"Click on 'HPV' session at School(name=\"The Queen Elizabeth's High School, Gainsborough\", urn='120655', site=None)","time":{"start":1761971377275,"stop":1761971377887,"duration":612},"status":"passed","steps":[{"name":"Click on {2} session at {1}","time":{"start":1761971377275,"stop":1761971377887,"duration":612},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(School(name=\"The Queen Elizabeth's High School, Gainsborough\", urn='120655', site=None), <Programme.HPV: 'HPV'>)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Consent tab","time":{"start":1761971377887,"stop":1761971378717,"duration":830},"status":"passed","steps":[{"name":"Click on Consent tab","time":{"start":1761971377887,"stop":1761971378717,"duration":830},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Select No response","time":{"start":1761971378717,"stop":1761971379311,"duration":594},"status":"passed","steps":[{"name":"Select No response","time":{"start":1761971378717,"stop":1761971379311,"duration":594},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on child Child(first_name='Katherine', last_name='NICHOLLS', nhs_number='9996839966', address=('Studio 5', 'William drives', 'East Abdulport', 'PO4 4HD'), date_of_birth=datetime.date(2009, 11, 12), year_group=11, parents=(Parent(full_name='Mark Howe-Booth', relationship='Dad', email_address='mitchellstuart@example.org'), Parent(full_name='Ms Tracy Clarke', relationship='Mum', email_address='margaretsmith@example.org')))","time":{"start":1761971379311,"stop":1761971409551,"duration":30240},"status":"broken","statusMessage":"playwright._impl._errors.TimeoutError: Locator.click: Timeout 30000ms exceeded.\nCall log:\n  - waiting for get_by_role(\"heading\", name=\"NICHOLLS, Katherine\").get_by_role(\"link\").first\n\n","statusTrace":"  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/allure_commons/_allure.py\", line 202, in impl\n    return func(*a, **kw)\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/mavis/test/annotations.py\", line 35, in wrapper\n    return_value = func(self, *args, **kwargs)\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/mavis/test/pages/sessions.py\", line 361, in click_child\n    ).first.click()\n            ~~~~~^^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/sync_api/_generated.py\", line 15543, in click\n    self._sync(\n    ~~~~~~~~~~^\n        self._impl_obj.click(\n        ^^^^^^^^^^^^^^^^^^^^^\n    ...<9 lines>...\n        )\n        ^\n    )\n    ^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/_impl/_sync_base.py\", line 115, in _sync\n    return task.result()\n           ~~~~~~~~~~~^^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/_impl/_locator.py\", line 160, in click\n    return await self._frame.click(self._selector, strict=True, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/_impl/_frame.py\", line 549, in click\n    await self._channel.send(\"click\", self._timeout, locals_to_params(locals()))\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py\", line 69, in send\n    return await self._connection.wrap_api_call(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py\", line 558, in wrap_api_call\n    raise rewrite_error(error, f\"{parsed_st['apiName']}: {error}\") from None\n","steps":[{"name":"Click on child {1}","time":{"start":1761971379311,"stop":1761971409550,"duration":30239},"status":"broken","statusMessage":"playwright._impl._errors.TimeoutError: Locator.click: Timeout 30000ms exceeded.\nCall log:\n  - waiting for get_by_role(\"heading\", name=\"NICHOLLS, Katherine\").get_by_role(\"link\").first\n\n","statusTrace":"  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/mavis/test/annotations.py\", line 35, in wrapper\n    return_value = func(self, *args, **kwargs)\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/mavis/test/pages/sessions.py\", line 361, in click_child\n    ).first.click()\n            ~~~~~^^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/sync_api/_generated.py\", line 15543, in click\n    self._sync(\n    ~~~~~~~~~~^\n        self._impl_obj.click(\n        ^^^^^^^^^^^^^^^^^^^^^\n    ...<9 lines>...\n        )\n        ^\n    )\n    ^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/_impl/_sync_base.py\", line 115, in _sync\n    return task.result()\n           ~~~~~~~~~~~^^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/_impl/_locator.py\", line 160, in click\n    return await self._frame.click(self._selector, strict=True, **params)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/_impl/_frame.py\", line 549, in click\n    await self._channel.send(\"click\", self._timeout, locals_to_params(locals()))\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py\", line 69, in send\n    return await self._connection.wrap_api_call(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n    ...<3 lines>...\n    )\n    ^\n  File \"/home/runner/work/manage-vaccinations-in-schools-testing/manage-vaccinations-in-schools-testing/.venv/lib/python3.14/site-packages/playwright/_impl/_connection.py\", line 558, in wrap_api_call\n    raise rewrite_error(error, f\"{parsed_st['apiName']}: {error}\") from None\n","steps":[],"attachments":[{"uid":"e2325597bf78e47e","name":"Screenshot on failure","source":"e2325597bf78e47e.png","type":"image/png","size":44969}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[{"name":"args","value":"(Child(first_name='Katherine', last_name='NICHOLLS', nhs_number='9996839966', address=('Studio 5', 'William drives', 'East Abdulport', 'PO4 4HD'), date_of_birth=datetime.date(2009, 11, 12), year_group=11, parents=(Parent(full_name='Mark Howe-Booth', relationship='Dad', email_address='mitchellstuart@example.org'), Parent(full_name='Ms Tracy Clarke', relationship='Mum', email_address='margaretsmith@example.org'))),)"}],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":1,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":8,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"setup_fixed_child::0","time":{"start":1761971409663,"stop":1761971410722,"duration":1059},"status":"passed","steps":[{"name":"Go to dashboard","time":{"start":1761971409663,"stop":1761971409833,"duration":170},"status":"passed","steps":[{"name":"Go to dashboard","time":{"start":1761971409663,"stop":1761971409833,"duration":170},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Manage vaccinations in schools","time":{"start":1761971409833,"stop":1761971410030,"duration":197},"status":"passed","steps":[{"name":"Click on Manage vaccinations in schools","time":{"start":1761971409833,"stop":1761971410030,"duration":197},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Click on Sessions","time":{"start":1761971410031,"stop":1761971410275,"duration":244},"status":"passed","steps":[{"name":"Click on Sessions","time":{"start":1761971410031,"stop":1761971410275,"duration":244},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":6,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"log_in_as_nurse::0","time":{"start":1761971410724,"stop":1761971411238,"duration":514},"status":"passed","steps":[{"name":"Log out","time":{"start":1761971410724,"stop":1761971411237,"duration":513},"status":"passed","steps":[{"name":"Log out","time":{"start":1761971410724,"stop":1761971411237,"duration":513},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":2,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"set_feature_flags::0","time":{"start":1761971411239,"stop":1761971411239,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context::0","time":{"start":1761971411240,"stop":1761971411249,"duration":9},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder::0","time":{"start":1761971411249,"stop":1761971411249,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder::0","time":{"start":1761972138341,"stop":1761972138341,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser::0","time":{"start":1761972138341,"stop":1761972138383,"duration":42},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright::0","time":{"start":1761972138384,"stop":1761972138395,"duration":11},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_team_after_tests::0","time":{"start":1761972138398,"stop":1761972141644,"duration":3246},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"tag","value":"bug"},{"name":"tag","value":"consent"},{"name":"parentSuite","value":"tests"},{"name":"suite","value":"test_verbal_consent"},{"name":"host","value":"runnervmf2e7y"},{"name":"thread","value":"3112-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_verbal_consent"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":true,"retry":true,"extra":{"categories":[],"tags":["bug","consent"]},"source":"33774308841268c2.json","parameterValues":[]}